{% extends 'base.html' %}
{% block title %}Live Feed - LabComply{% endblock %}
{% block content %}

<h2 class="mb-2">Live Feed Overview</h2>

{% if lab_name %}
<div class="alert alert-info">
    Viewing Lab: <strong>{{ lab_name }}</strong>
</div>
{% else %}
<div class="alert alert-warning">
    No lab selected. Please select a lab from the sidebar.
</div>
{% endif %}

{# Display live camera feeds #}
{% if cameras and cameras|length > 0 %}
<div class="row">
    {% for camera in cameras %}
    <div class="col-md-4 mb-4">
        <div class="card shadow-sm">
            <div class="card-header bg-dark text-white">
                <h6 class="mb-0">{{ camera.name }}</h6>
            </div>
            <img src="{{ url_for('video_feed', camera_id=camera.camera_id) }}" class="card-img-top"
                 alt="Live feed {{ camera.name }}" style="height: 300px; object-fit: fill;">
            <div class="card-body">
                <a href="{{ url_for('all_incompliance', lab=lab_name, camera=camera.name) }}"
                   class="btn btn-primary btn-sm">
                    View Incompliances
                </a>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

{# Pagination controls #}
{% if total_pages > 1 %}
<nav aria-label="Camera pagination">
    <ul class="pagination justify-content-center">
        {# Previous page link #}
        {% if current_page > 1 %}
        <li class="page-item">
            <a class="page-link" href="{{ url_for('index', lab=lab_name, page=current_page-1) }}" aria-label="Previous">
                &laquo; Previous
            </a>
        </li>
        {% endif %}

        {# Page number links #}
        {% for page_num in range(1, total_pages + 1) %}
        <li class="page-item {% if page_num == current_page %}active{% endif %}">
            <a class="page-link" href="{{ url_for('index', lab=lab_name, page=page_num) }}">{{ page_num }}</a>
        </li>
        {% endfor %}

        {# Next page link #}
        {% if current_page < total_pages %}
        <li class="page-item">
            <a class="page-link" href="{{ url_for('index', lab=lab_name, page=current_page+1) }}" aria-label="Next">
                Next &raquo;
            </a>
        </li>
        {% endif %}
    </ul>
</nav>
{% endif %}

{% else %}
<div class="alert alert-secondary">
    No cameras available for this lab.
</div>
{% endif %}

{% endblock %}